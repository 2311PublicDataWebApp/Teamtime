<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head th:replace="layout/head::header"></head>
	<body id="page-top">
		<th:block sec:authorize="isAuthenticated()">
		    <!-- Page Wrapper -->
		    <div id="wrapper">
		    	<div th:replace="layout/sidebar::sidebar"></div>
		        <!-- Content Wrapper -->
		        <div id="content-wrapper" class="d-flex flex-column">
		            <!-- Main Content -->
		            <div id="content">
		                <div th:replace="layout/topbar::topbar"></div>
		                <!-- Begin Page Content -->
	                    <div class="container-fluid">
	                    <!-- Page Heading -->
	                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
	                        <h1 class="h3 mb-0 text-gray-800">마이 프로필</h1>
	                    </div>
	                        <div class="row">
	                            <div class="col-xl-4">
	                                <!-- Profile picture card-->
	                                <div class="card mb-4 mb-xl-0">
	                                    <div class="card-header">프로필 사진</div>
	                                    <div class="card-body text-center">
	                                    	<form id="profileForm" enctype="multipart/form-data">
		                                        <!-- Profile picture image-->
		                                        <th:block th:if="${not #strings.isEmpty(imageFile)}">
<!-- 		                                        	<img class="img-account-profile rounded-circle mb-2" src="assets/img/illustrations/profiles/profile-1.png" alt=""> -->
		                                        </th:block>
		                                        <th:block th:if="${#strings.isEmpty(imageFile)}">
		                                        	<img class="img-account-profile rounded-circle my-3" src="../images/common/undraw_profile.svg">
		                                        	<br>                                    
		                                        </th:block>
		                                        <!-- Profile picture upload button-->
		                                        <button class="btn btn-primary my-3" type="button" th:onclick="updateProfileImg();">새로운 이미지 업로드</button>
	                                        </form>
	                                    </div>
	                                </div>
	                            </div>
	                            <div class="col-xl-8">
	                                <!-- Account details card-->
	                                <div class="card mb-4">
	                                    <div class="card-header">계정 정보</div>
	                                    <div class="card-body">
                                            <div class="mb-3">
                                                <label class="small mb-1" for="inputUserId">아이디</label>
                                                <input class="form-control" id="inputUserId" type="text" name="userId" th:value="${user.userId}" readonly />
                                            </div>
                                            <div class="row gx-3 mb-3">
                                                <!-- Form Group (이름)-->
                                                <div class="col-md-6">
                                                    <label class="small mb-1" for="inputUserName">이름</label>
                                                    <input class="form-control" id="inputUserName" type="text" name="userName" th:value="${user.userName}" readonly />
                                                </div>
                                                <!-- Form Group (닉네임)-->
                                                <div class="col-md-6">
                                                    <label class="small mb-1" for="inputUserNickname">닉네임</label>
                                                    <input class="form-control" id="inputUserNickname" type="text" name="userNickname" th:value="${user.userNickname}">
                                                </div>
                                            </div>
                                            <!-- Form Group (email address)-->
                                            <div class="mb-3">
                                                <label class="small mb-1" for="inputEmailAddress">이메일</label>
                                                <input class="form-control" id="inputEmailAddress" type="email" name="userEmail" th:value="${user.userEmail}">
                                            </div>
                                            <!-- Form Group (email address)-->
                                            <div class="mb-4">
                                                <label class="small mb-1" for="inputPhone">휴대폰 번호</label>
                                                <input class="form-control" id="inputPhone" type="number" name="userPhone" th:value="${user.userPhone}">
                                            </div>
                                             <!-- Form Row-->
                                            <div class="row gx-3 mb-2">
	                                            <div class="col-md-9"></div>
	                                            <!-- Save changes button-->
	                                            <div class="col-md-3 mb-2 text-right">
	                                            	<button type="button" class="btn btn-primary" th:onclick="updateUser();">변경사항 저장하기</button>
	                                            </div>
                                            </div>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
		            </div>
		            <!-- End of Main Content -->
		            <div th:replace="layout/footer::footer"></div>
		        </div>
		        <!-- End of Content Wrapper -->
		    </div>
		    <!-- End of Page Wrapper -->
		    <!-- Scroll to Top Button-->
		    <a class="scroll-to-top rounded" href="#page-top">
		        <i class="fas fa-angle-up"></i>
		    </a>
	   	</th:block>
		<script type="text/javascript">
			function updateProfileImg() {
				var form = $('#profileForm')[0];
				var formData = new FormData(form);
				$.ajax({
					url : "/user/update.do",
					type : "POST",
					data : formData,
					success : function(data) {
						if (data == "success") {
							alert("프로필 사진 수정이 완료되었습니다.");
							location.reload();
						} else {
							alert("실패!");
						}
					},
					error : function() {
						alert("에러!");
					},
					cache: false,
					contentType: false,
					processData: false
				});
			}
			
			function updateUser() {
				var userId = $("#inputUserId").val();
				var userName = $("#inputUserName").val();
				var userNickname = $("#inputUserNickname").val();
				var userEmail = $("#inputEmailAddress").val();
				var userPhone = $("#inputPhone").val();
				$.ajax({
					url : "/user/update.do",
					type : "POST",
					data : { "userId" : userId
						, "userName" : userName
						, "userNickname" : userNickname
						, "userEmail" : userEmail
						, "userPhone" : userPhone
					},
					success : function(data) {
						if (data == "success") {
							location.href = "/user/myPage.do";
							location.reload();
						} else {
							alert("실패!");
							location.href = "/user/myPage.do";
						}
					},
					error : function() {
						alert("에러!");
					}
				});
			}
		</script>
	</body>
</html>